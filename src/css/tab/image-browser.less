/*
 * Copyright (C) 2025 Jukka Svahn
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation
 * the rights to use, copy, modify, merge, publish, distribute, sublicense,
 * and/or sell copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */

/**
 * Image browser tab.
 *
 * [1] Inline style.
 * [2] Default styles use important.
 * [3] Overriding specificity.
 * [4] Negates the current surrounding spacing.
 */
:root #tab_image_browser {
  #image_browser_tab_txt2img_image_browser,
  #image_browser_tab_img2img_image_browser,
  #image_browser_tab_txt2img-grids_image_browser,
  #image_browser_tab_img2img-grids_image_browser,
  #image_browser_tab_extras_image_browser,
  #image_browser_tab_favorites_image_browser,
  #image_browser_tab_all_image_browser {
    /**
     * Content columns container.
     */
    > .gradio-column > .gradio-row {
      flex-wrap: wrap;
      gap: var(--margin-xl) !important; // [2]
    }

    /**
     * Left column.
     */
    > .gradio-column > .gradio-row > .gradio-column:first-child {
      gap: var(--margin-xl);
      min-width: min(640px, 100%) !important; // [1]

      > *:not(#image_browser_tab_txt2img_image_browser_gallery_controls) {
        .gradio-box.padded {
          padding: var(--padding-m) !important; // [2]
        }

        .prose {
          p {
            line-height: 2;
            margin: 0;
          }

          b {
            text-transform: uppercase;
          }

          br {
            content: "";
            display: block;
            font-size: 200%;
            margin: 2em;

            &::after {
              content: "> ";
              display: block;
              height: 20px;
            }
          }
        }
      }
    }
  }

  /**
   * Pagination toolbar.
   */
  #image_browser_tab_txt2img_image_browser_gallery_controls,
  #image_browser_tab_img2img_image_browser_gallery_controls,
  #image_browser_tab_txt2img-grids_image_browser_gallery_controls,
  #image_browser_tab_img2img-grids_image_browser_gallery_controls,
  #image_browser_tab_extras_image_browser_gallery_controls,
  #image_browser_tab_favorites_image_browser_gallery_controls,
  #image_browser_tab_all_image_browser_gallery_controls {
    align-items: end;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    gap: var(--padding-xs) !important;
    margin: 0;
    order: -2;

    > * {
      min-width: fit-content !important; // [1]
    }

    button {
      align-self: center !important; // [3]
      flex-grow: 1;
      min-width: fit-content;
      overflow: hidden;
      white-space: nowrap;
      word-break: keep-all;
      text-align: left;
    }

    .form {
      gap: 0 !important; // [3]
    }

    button, input[type=number] {
      min-height: 44px;
    }

    .refresh-index-panel {
      min-width: auto !important; // [1]
    }

    /**
     * Image gallery row.
     */
    + .gradio-row + .gradio-row {
      order: -1;
    }
  }

  /**
   * Page index field.
   */
  #image_browser_tab_txt2img_control_image_browser_page_index,
  #image_browser_tab_img2img_control_image_browser_page_index,
  #image_browser_tab_txt2img-grids_control_image_browser_page_index,
  #image_browser_tab_img2img-grids_control_image_browser_page_index,
  #image_browser_tab_extras_control_image_browser_page_index,
  #image_browser_tab_favorites_control_image_browser_page_index,
  #image_browser_tab_all_control_image_browser_page_index {
    margin: 0 !important; // [2]

    label {
      position: relative;

      span {
        pointer-events: none;
        position: absolute;
        bottom: 0;
        top: 0;
        left: 0;
        right: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        padding: var(--padding-s);
        display: flex;
        align-items: center;
      }

      input {
        color: transparent;
      }

      &:focus,
      &:focus-within {
        input {
          color: initial;
        }

        span {
          display: none;
        }
      }
    }
  }

  #image_browser_tab_txt2img_control_image_browser_refresh_index,
  #image_browser_tab_img2img_control_image_browser_refresh_index,
  #image_browser_tab_txt2img-grids_control_image_browser_refresh_index,
  #image_browser_tab_img2img-grids_control_image_browser_refresh_index,
  #image_browser_tab_extras_control_image_browser_refresh_index,
  #image_browser_tab_favorites_control_image_browser_refresh_index,
  #image_browser_tab_all_control_image_browser_refresh_index {
    min-width: 44px !important; // [2]
    min-height: 44px !important; // [2]
  }

  /**
   * Ranking and other columns.
   */
  #image_browser_tab_txt2img_image_browser_gallery_controls,
  #image_browser_tab_img2img_image_browser_gallery_controls,
  #image_browser_tab_txt2img-grids_image_browser_gallery_controls,
  #image_browser_tab_img2img-grids_image_browser_gallery_controls,
  #image_browser_tab_extras_image_browser_gallery_controls,
  #image_browser_tab_favorites_image_browser_gallery_controls,
  #image_browser_tab_all_image_browser_gallery_controls {
    & + .gradio-row {
      flex-direction: column;
    }
  }

  /**
   * Ranking.
   */
  #image_browser_tab_txt2img_control_image_browser_ranking,
  #image_browser_tab_img2img_control_image_browser_ranking,
  #image_browser_tab_txt2img-grids_control_image_browser_ranking,
  #image_browser_tab_img2img-grids_control_image_browser_ranking,
  #image_browser_tab_extras_control_image_browser_ranking,
  #image_browser_tab_favorites_control_image_browser_ranking,
  #image_browser_tab_all_control_image_browser_ranking {
    align-items: start;
    display: flex;
    flex-direction: column;
    margin: 0;
  }

  #image_browser_tab_txt2img_image_browser_container,
  #image_browser_tab_img2img_image_browser_container,
  #image_browser_tab_txt2img-grids_image_browser_container,
  #image_browser_tab_img2img-grids_image_browser_container,
  #image_browser_tab_extras_image_browser_container,
  #image_browser_tab_favorites_image_browser_container,
  #image_browser_tab_all_image_browser_container {
    > div:first-child {
      /**
       * Information block.
       */
      > div:first-child {
        order: 2;

        * {
          color: inherit !important; // [1]
          font-size: inherit !important; // [1]
          text-align: inherit !important; // [1]
        }
      }
    }
  }

  p.no-gap-top.mb-0.text-subdued {
    margin-top: var(--margin-xs);
  }

  /**
   * Right column.
   */
  .right-column-panel {
    gap: var(--margin-xl);
    margin: 0 !important; // [2]
    min-width: min(360px, 100%) !important; // [1]

    > .gradio-box {
      padding: var(--padding-m) !important; // [2]
    }

    textarea[style][rows="1"] {
      min-height: 64px !important; // [1]
    }
  }

  /**
   * Formatted image info.
   */
  .image_browser_file_info_formatted {
    overflow: visible !important; // [3]

    .table-wrap {
      border: 0;
      border-top-left-radius: 0;
      border-top-right-radius: 0;
      margin: var(--margin-m) calc(var(--padding-m) * -1) calc(var(--padding-m) * -1) calc(var(--padding-m) * -1); // [4]
      width: calc(100% + var(--padding-m) * 2);

      table, tbody, tr, td {
        font: inherit !important; // [3]
      }

      td {
        padding: 0 !important; // [3]
      }
    }
  }
}
